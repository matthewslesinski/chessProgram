package search;

import java.util.Comparator;
import java.util.function.BinaryOperator;
import java.util.function.Function;
import java.util.function.ToDoubleFunction;

import moves.Move;
import representation.Board;
import static support.UtilityFunctions.*;

public class BasicDepthBasedMinimax implements AI {

	private static final int MAX_PLIES = 5;
	
	@Override
	public Move bestMove(Board board) {
		return board.getLegalMoves().stream().reduce((move1, move2) -> argmax(bindAtEnd(BasicDepthBasedMinimax::bestMoveHelper, (Integer) MAX_PLIES), board.performMove(move1), board.performMove(move2))).get();
	}
	
	private static double bestMoveHelper(Board board, int pliesLeft) {
		if (pliesLeft == 0) {
			return board.evaluate();
		}
		BinaryOperator<Double> optimumFinder = board.whoseMove().isWhite() ? Math::max : Math::min;
		return board.getLegalMoves().stream()
				.map(bindAtEnd(BasicDepthBasedMinimax::bestMoveHelper, pliesLeft - 1).compose(board::performMove))
				.reduce(optimumFinder).get();
	}

}
